{
  # Global options
  auto_https off
  admin 0.0.0.0:2019
}

# Catch-all configuration for any hostname (localhost, IP, domain)
:80 {
  # Simple reverse proxy to Next.js application container
  reverse_proxy web:8080 {
    # Health check to ensure backend is ready
    health_uri /
    health_interval 10s
    health_timeout 5s
    health_status 2xx

    transport http {
      read_timeout 60s
      write_timeout 60s
      dial_timeout 30s
    }

    # Retry on connection failures
    lb_try_duration 30s
    lb_try_interval 2s
  }

  # Enable compression
  encode gzip

  # Logging
  log {
    output stdout
    format console
  }
}

# Health check endpoint
:8000 {
  respond /health "OK" 200
}
